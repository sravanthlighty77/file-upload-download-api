<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Notes</title>
<script type="text/javascript" src="jquery-3.5.1.js"></script>
<script type="text/javascript" src="angular.js"></script>
<script type="text/javascript" src="angular-route.js"></script>
<script type="text/javascript" src="bootstrap.js"></script>

<link href="bootstrap.css" rel="stylesheet">
<link href="bootstrap.min.css" rel="stylesheet">
<script type="text/javascript">
var application = angular.module('NotesApplication',["ngRoute"]);
application.controller('NotesController', function($scope, $http){
	$scope.notesList = {};
	$scope.message = null;
	$scope.note = {};
	$scope.updateNote = {};
	$scope.note.title = null;
	$scope.note.description = null;
	$scope.note.id = null;
	$scope.updateNote.title = null;
	$scope.updateNote.description = null;
	$scope.updateNote.id = null;
	$scope.searchValue = "";
	$scope.uploadFile = null;
	
	// Get Notes List
	$http.get("http://localhost:8080/notes/list").then(function(response){
		$scope.notesList = response.data;
		$scope.message = null;
	}, function(response){
		$scope.message = response.data.message;
		$scope.notesList = null;
	});
	
	$scope.update = function(note,id){
		$scope.updateNote.title = note.title;
		$scope.updateNote.description = note.description;
		$scope.updateNote.id = id;
		$scope.note = {};
		
	}
	
	$scope.deleteNote = function(id){
		$http.delete("http://localhost:8080/notes/delete/"+id).then(function(response){
			$scope.notesList = response.data;
			$scope.message = null;
			$scope.note = {};
			
		}, function(){
			$scope.note = null;
			$scope.message = 'Notes Failed to Add';
		})
	}
	
	$scope.updateNote = function(){
		let data = angular.toJson($scope.updateNote);
		$http.put("http://localhost:8080/notes/update",data).then(function(response){
			$scope.notesList = response.data;
			$scope.message = null;
			$scope.updateNote = {};
			
		}, function(){
			$scope.note = null;
			$scope.message = 'Notes Failed to Add';
		})
	}
	
	$scope.showUpload = function(){
		let file = document.getElementById('uploadFile').files[0];
		let formData = new FormData();
		formData.append("file", file, file.name);
		
		var config = {
		           transformRequest: angular.identity,
		           transformResponse: angular.identity,
		         headers : {
		           'Content-Type': undefined
		           }
		       }
		
		$http.post("http://localhost:8080/notes/fileUpload", formData, config
		).then(function(response){
			$scope.message = response.data;
		}, function(response){
			$scope.message = 'file failed to uplaod';
		});
		alert("size:"+file.size+"\n"+"file-type:"+file.type+"\n"+"file-name:"+file.name);
	}
	
	$scope.search = function(){
		if($scope.searchValue == ""){
			$http.get("http://localhost:8080/notes/list").then(function(response){
				$scope.notesList = response.data;
				$scope.message = null;
			}, function(response){
				$scope.message = response.data.message;
				$scope.notesList = null;
			});
		}else{
			$http.get("http://localhost:8080/notes/search/"+$scope.searchValue).then(function(response){
				$scope.notesList = response.data;
				$scope.message = null;
			}, function(response){
				$scope.message = response.data.message;
				$scope.notesList = null;
			});
		}
		
		
	}
	
	
	$scope.addNote = function(){
		let data = angular.toJson($scope.note);
		$http.post("http://localhost:8080/notes/add",data).then(function(response){
			$scope.notesList = response.data;
			$scope.message = null;
			$scope.note = {};
			
		}, function(){
			$scope.note = null;
			$scope.message = 'Notes Failed to Add';
		})
	}
});

application.config(['$routeProvider', function($routeProvider){
	$routeProvider
	.when('/update',{
		templateUrl : 'updateNote.html'
	}).otherwise({
		redirectTo : '/'
	})
}])
</script>
</head>
<body ng-app = "NotesApplication">
<div ng-controller = "NotesController">
	<div class="container">
	<nav class="navbar navbar-dark bg-dark justify-content-between">
	<div class="navbar-header">
	<a href="#" class="navbar-brand">Home</a>
	<input type="button" class="btn btn-outline-success text-white" 
				value="New" data-toggle="modal" data-target="#addnote">
	</div>
	<div>
	<span>
		<input type="text" placeholder="search ..."  class="form-control border border-primary rounded" ng-model="searchValue" ng-keyup="search()">
	</span>
	</div>
	</nav>
	</div>
	<br>
	<form enctype="multipart/form-data">
	<input type="file" class="form-control" id = "uploadFile"><button ng-click = "showUpload()" class="btn btn-secondary">upload</button>
	</form>
	<div class="container">
	<div class="row">
		<div class="col-md-2"></div>
		<div class="col-md-8">
		<h2 class="text-center">Notes</h2><br>
		<div class="text-danger" align="center">
		<h4 ng-bind = "message" ></h4>
		</div>
			<table class="table table-striped table-hover" ng-if="notesList">
			<thead class="text-center text-primary font-weight-bold">
				<tr>
					<td>Title</td>
					<td>Description</td>
					<td>Update</td>
					<td>Delete</td>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat = "note in notesList">
					<td ng-model = "note.title">{{note.title}}</td>
					<td ng-model = "note.description">{{note.description}}</td>
					<td><input type="button" value="Edit" class="btn btn-primary" ng-click="update(note, note.id)" data-toggle="modal" data-target="#updatenote" title="update notes"></td>
						<td><input type="button" value="Delete" class="btn btn-danger"  ng-click="deleteNote(note.id)">
					</td>
				</tr>
			</tbody>
		</table>
		<br><br>
	</div>
		
	</div>
	
	
	<!-- Add Note modal -->
	<div class="modal fade" id="addnote">
			<div class="modal-dialog">
				<div class="modal-content">
				
					<div class="modal-header">
						<h4 class="modal-title">Add Notes</h4>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>
					
					<div class="modal-body">
						<form ng-submit="addNote()">
						<input type="hidden" ng-model = "note.id">
							<div class="form-group">
								<label>Title: </label> <input type="text" ng-model="note.title" required="required" class="form-control">
							</div>
							<div class="form-group">
								<label>Description: </label><textarea rows="" cols="" class="form-control" ng-model="note.description"></textarea>
							</div><br>
							<input type="submit" value="Add" class="btn btn-success form-control">
						
						
						</form>
						
					</div>
					
				</div>
			</div>
		</div>
		<div class="modal fade" id="updatenote">
			<div class="modal-dialog">
				<div class="modal-content">
				
					<div class="modal-header">
						<h4 class="modal-title">Update Notes</h4>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>
					
					<div class="modal-body">
						<form ng-submit="updateNote()">
						<input type="hidden" ng-model = "updateNote.id" ng-value="ng.id ">
							<div class="form-group">
								<label>Title: </label> <input type="text" ng-model="updateNote.title" required="required" class="form-control" ng-value= "updateNote.title">
							</div>
							<div class="form-group">
								<label>Description: </label><textarea rows="" cols="" class="form-control" ng-model="updateNote.description" ng-value = "updateNote.description"></textarea>
							</div><br>
							<input type="submit" value="Add" class="btn btn-success form-control">
						
						
						</form>
						
					</div>
					
				</div>
			</div>
		</div>
</div>

</body>
</html>